# Dockerizing a Node.js Backend (Step-by-Step)

This document explains how to containerize a Node.js backend using Docker, build the image, run the container, and follow best practices for production-ready setups.

---

## 1. Prerequisites

Ensure the following are installed:

* Node.js (for local testing)
* Docker Desktop
* A working Node.js backend application

Your backend should start correctly using:

```bash
node server.js
```

Or preferably using npm:

```bash
npm start
```

Update `package.json` if needed:

```json
"scripts": {
  "start": "node server.js"
}
```

---

## 2. Dockerfile

Create a file named `Dockerfile` in the project root:

```dockerfile
FROM node:18-alpine

WORKDIR /app

COPY package*.json ./
RUN npm install --production

COPY . .

EXPOSE 5000

CMD ["npm", "start"]
```

### Explanation

* **FROM**: Uses lightweight Node 18 Alpine image
* **WORKDIR**: Sets working directory inside container
* **COPY package*.json**: Copies dependency files
* **RUN npm install --production**: Installs only production dependencies
* **COPY . .**: Copies source code
* **EXPOSE 5000**: Exposes application port
* **CMD**: Starts the application

---

## 3. .dockerignore (Recommended)

Create a `.dockerignore` file to reduce image size and improve security:

```
node_modules
npm-debug.log
.env
.git
```

---

## 4. Build Docker Image

Run the following command from the project directory:

```bash
docker build -t my-node-backend .
```

Verify image creation:

```bash
docker images
```

---

## 5. Run Docker Container

Run the backend container and map ports:

```bash
docker run -p 5000:5000 my-node-backend
```

Access the application:

```
http://localhost:5000
```

---

## 6. Run in Detached Mode (Background)

```bash
docker run -d -p 5000:5000 --name node-backend my-node-backend
```

Useful commands:

```bash
docker ps
```

```bash
docker logs node-backend
```

---

## 7. Environment Variables

Avoid hardcoding secrets and configuration values.

Run container with environment variables:

```bash
docker run -d -p 5000:5000 \
  -e PORT=5000 \
  -e DB_URL=mongodb://host.docker.internal:27017/mydb \
  --name node-backend \
  my-node-backend
```

In Node.js:

```js
const PORT = process.env.PORT || 5000;
```

---

## 8. Important Networking Note

Ensure your server listens on all interfaces:

```js
app.listen(PORT, '0.0.0.0');
```

Using `localhost` will prevent Docker from exposing the service.

---

## 9. Push Image to Docker Hub (Optional)

Login to Docker Hub:

```bash
docker login
```

Tag the image:

```bash
docker tag my-node-backend yourusername/my-node-backend
```

Push the image:

```bash
docker push yourusername/my-node-backend
```

---

## 10. Common Issues & Fixes

### Application Not Reachable

* Ensure correct port mapping
* Ensure app listens on `0.0.0.0`

### Database Connection Fails

* Use `host.docker.internal` instead of `localhost` for local databases

---

## 11. Recommended Next Steps

* Add **Docker Compose** (Node + Database)
* Set up **CI/CD** with GitHub Actions
* Deploy to **AWS / DigitalOcean / Railway**
* Add health checks and logging

---

**Status:** Production-ready Dockerized Node.js backend
